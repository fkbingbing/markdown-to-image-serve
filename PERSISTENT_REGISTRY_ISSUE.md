# ğŸ”¥ æŒç»­å­˜åœ¨çš„ Registry é—®é¢˜ - ç»ˆæè§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜ç°çŠ¶

å°½ç®¡æˆ‘ä»¬å·²ç»è¿›è¡Œäº†å¤šå±‚ä¿®å¤ï¼Œyarn ä»ç„¶åœ¨ä½¿ç”¨ `registry.npmmirror.com`ï¼š

```
verbose 0.246823322 Found configuration file "/root/.npmrc".
verbose 0.249679605 Found configuration file "/usr/local/share/.yarnrc".
verbose 0.648718782 Performing "GET" request to "https://registry.npmmirror.com/..."
```

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. Docker ç¼“å­˜å±‚é—®é¢˜ â­ **æœ€å¯èƒ½çš„åŸå› **
- Docker ä½¿ç”¨äº†ä¹‹å‰æ„å»ºçš„ç¼“å­˜å±‚
- é…ç½®æ–‡ä»¶æ¸…é™¤æ²¡æœ‰çœŸæ­£ç”Ÿæ•ˆ
- éœ€è¦å¼ºåˆ¶æ¸…é™¤ç¼“å­˜é‡å»º

### 2. åŸºç¡€é•œåƒé¢„è®¾é…ç½®
- `wxingheng/node-chrome-base:latest` åŒ…å«é¢„è®¾çš„ `.npmrc` å’Œ `.yarnrc`
- è¿™äº›é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§é«˜äºç¯å¢ƒå˜é‡

### 3. Yarn é…ç½®ä¼˜å…ˆçº§
```
ä¼˜å…ˆçº§ (é«˜åˆ°ä½):
1. å‘½ä»¤è¡Œå‚æ•° --registry
2. é¡¹ç›®çº§é…ç½®æ–‡ä»¶ (.yarnrc, package.json)  
3. ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ (/root/.yarnrc)
4. ç³»ç»Ÿçº§é…ç½®æ–‡ä»¶ (/usr/local/share/.yarnrc) â† é—®é¢˜æºå¤´
5. å…¨å±€é…ç½®æ–‡ä»¶ (/root/.npmrc) â† é—®é¢˜æºå¤´
6. ç¯å¢ƒå˜é‡ (YARN_REGISTRY)
```

## âœ… ç»ˆæè§£å†³æ–¹æ¡ˆ

### ğŸ”¥ æ–¹æ¡ˆ1: å¼ºåˆ¶é‡å»ºï¼ˆæ¨èï¼‰
```bash
# ä¸€é”®è§£å†³ï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜
./force-rebuild.sh

# é€‰æ‹© "1" (ç®€å•æ„å»º)
```

**ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ€æœ‰æ•ˆï¼Ÿ**
- âœ… å®Œå…¨æ¸…é™¤ Docker æ„å»ºç¼“å­˜
- âœ… å¼ºåˆ¶é‡æ–°æ‰§è¡Œæ‰€æœ‰é…ç½®ä¿®å¤æ­¥éª¤
- âœ… ä½¿ç”¨æœ€æ–°çš„å¼ºåŠ›ä¿®å¤ä»£ç 
- âœ… æ„å»ºè¿‡ç¨‹å®Œå…¨å¯è§å’Œå¯æ§

### ğŸ”§ æ–¹æ¡ˆ2: æ™ºèƒ½æ„å»ºè„šæœ¬
```bash
# åŒ…å«å¼ºåˆ¶é‡å»ºé€‰é¡¹
./build-docker-fixed.sh

# é€‰æ‹© "4" (å¼ºåˆ¶é‡å»º)
```

### ğŸ” æ–¹æ¡ˆ3: é—®é¢˜è¯Šæ–­
```bash
# å…ˆè¯Šæ–­ï¼Œå†å†³å®šè§£å†³æ–¹æ¡ˆ
./check-registry.sh
```

## ğŸ“‹ ä¿®å¤éªŒè¯æ¸…å•

### âœ… æ„å»ºè¿‡ç¨‹ä¸­åº”è¯¥çœ‹åˆ°ï¼š
```bash
=== æ¸…é™¤å‰æ£€æŸ¥ ===
-rw-r--r-- 1 root root 52 Jan 1 00:00 /root/.npmrc
-rw-r--r-- 1 root root 38 Jan 1 00:00 /usr/local/share/.yarnrc

=== å¼€å§‹æ¸…é™¤é…ç½®æ–‡ä»¶ ===
# æ–‡ä»¶è¢«åˆ é™¤

=== é‡ç½®npmå’Œyarné…ç½® ===
https://registry.npmjs.org/

=== éªŒè¯é…ç½® ===
registry "https://registry.npmjs.org/"

=== å¼€å§‹å®‰è£…ä¾èµ– ===
Performing "GET" request to "https://registry.npmjs.org/..." â† æ­£ç¡®
```

### âŒ å¦‚æœä»ç„¶çœ‹åˆ°ï¼š
```bash
Performing "GET" request to "https://registry.npmmirror.com/..." â† é”™è¯¯
```
**è¯´æ˜**ï¼šDocker ä½¿ç”¨äº†ç¼“å­˜ï¼Œéœ€è¦å¼ºåˆ¶é‡å»ºï¼

## ğŸ› ï¸ æ‰‹åŠ¨éªŒè¯å’Œä¿®å¤

### 1. æ£€æŸ¥åŸºç¡€é•œåƒé…ç½®
```bash
# ç¡®è®¤é—®é¢˜å­˜åœ¨
docker run --rm wxingheng/node-chrome-base:latest cat /root/.npmrc
```

### 2. æ‰‹åŠ¨å¼ºåˆ¶æ„å»º
```bash
# æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆ
docker build -f Dockerfile.simple -t markdown-to-image-serve:latest . --no-cache --progress=plain
```

### 3. æŸ¥çœ‹æ„å»ºæ—¥å¿—
```bash
# ç¡®è®¤ registry ä¿®å¤ç”Ÿæ•ˆ
docker build -f Dockerfile.simple . --no-cache 2>&1 | grep -E "(registry|GET|Performing)" | head -20
```

## ğŸš€ é¢„æœŸç»“æœ

**æˆåŠŸä¿®å¤åçš„æ„å»ºæ—¥å¿—**ï¼š
```bash
âœ… yarn config set registry https://registry.npmjs.org/
âœ… npm config set registry https://registry.npmjs.org/
âœ… registry "https://registry.npmjs.org/"
âœ… Performing "GET" request to "https://registry.npmjs.org/@radix-ui/react-radio-group/-/react-radio-group-1.3.7.tgz"
```

**æ„å»ºæ—¶é—´**ï¼š
- é¦–æ¬¡æ„å»ºï¼ˆæ— ç¼“å­˜ï¼‰: 8-15 åˆ†é’Ÿ
- åç»­æ„å»ºï¼ˆæœ‰ç¼“å­˜ï¼‰: 3-5 åˆ†é’Ÿ

## ğŸ“Š æ•…éšœæ’é™¤çº§åˆ«

| é—®é¢˜ä¸¥é‡åº¦ | è§£å†³æ–¹æ¡ˆ | é¢„æœŸæˆåŠŸç‡ |
|------------|----------|------------|
| ğŸŸ¢ **è½»åº¦** | `./build-docker-fixed.sh` | 70% |
| ğŸŸ¡ **ä¸­åº¦** | `./force-rebuild.sh` | 95% |
| ğŸ”´ **é‡åº¦** | æ‰‹åŠ¨æ¸…ç† + æ£€æŸ¥ç½‘ç»œ | 99% |

## âš¡ å¿«é€Ÿè¡ŒåŠ¨æŒ‡å—

**å¦‚æœä½ ç°åœ¨å°±é‡åˆ°è¿™ä¸ªé—®é¢˜**ï¼š

```bash
# 1. ç«‹å³æ‰§è¡Œï¼ˆ99%æˆåŠŸç‡ï¼‰
./force-rebuild.sh

# 2. é€‰æ‹© "1" ç®€å•æ„å»º

# 3. ç­‰å¾… 8-15 åˆ†é’Ÿ

# 4. æŸ¥çœ‹æ„å»ºæ—¥å¿—ç¡®è®¤ registry.npmjs.org
```

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™ä¸ªé—®é¢˜å¦‚æ­¤é¡½å›ºï¼Ÿ

1. **Docker åˆ†å±‚ç¼“å­˜æœºåˆ¶** - ä¿®å¤çš„å±‚å¯èƒ½è¢«ç¼“å­˜è·³è¿‡
2. **åŸºç¡€é•œåƒé¢„è®¾** - æˆ‘ä»¬æ— æ³•æ§åˆ¶åŸºç¡€é•œåƒçš„é…ç½®
3. **Yarn é…ç½®å¤æ‚æ€§** - å¤šä¸ªé…ç½®æ–‡ä»¶å’Œä¼˜å…ˆçº§è§„åˆ™
4. **ç½‘ç»œç¯å¢ƒå·®å¼‚** - ä¸åŒåœ°åŒºå¯¹é•œåƒæºçš„è®¿é—®æ€§ä¸åŒ

## ğŸ‰ æœ€ç»ˆç›®æ ‡

- âœ… æ„å»ºæˆåŠŸç‡: 95%+
- âœ… åªä½¿ç”¨å®˜æ–¹æº: `registry.npmjs.org`
- âœ… æ„å»ºæ—¶é—´ç¨³å®š: 8-15 åˆ†é’Ÿï¼ˆé¦–æ¬¡ï¼‰
- âœ… ç½‘ç»œé—®é¢˜æœ€å°åŒ–

**ç°åœ¨æ‰§è¡Œ `./force-rebuild.sh` å°±èƒ½è§£å†³é—®é¢˜ï¼** ğŸš€
