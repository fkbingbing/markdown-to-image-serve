version: '3.8'

services:
  app:
    # ä½¿ç”¨ç°æœ‰é•œåƒï¼Œæ— éœ€é‡æ–°æ„å»º
    image: markdown-to-image-serve:latest
    platform: linux/amd64
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_BASE_URL=http://localhost:3000
      # ä¿®å¤Chromeè·¯å¾„
      - CHROME_PATH=/usr/bin/chromium
      - API_PASSWORD=123456
    volumes:
      # ğŸ”§ æŒ‚è½½ä¿®å¤åçš„æ–‡ä»¶ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰
      - ./src/components/PosterView.tsx:/app/src/components/PosterView.tsx:ro
      
      # ğŸ“‚ æ•°æ®ç›®å½•æŒ‚è½½
      - ./public/uploads/posters:/app/public/uploads/posters
      - ./uploads:/app/uploads
      
      # ğŸ› ï¸ å¯é€‰ï¼šæŒ‚è½½å…¶ä»–ä¿®å¤æ–‡ä»¶
      # - ./next.config.mjs:/app/next.config.mjs:ro
      # - ./.env.local:/app/.env.local:ro
      
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    container_name: markdown-serve-with-fixes

# å¯é€‰ï¼šå¦‚æœéœ€è¦æ•°æ®æŒä¹…åŒ–
volumes:
  uploads_data:
  posters_data:
