# åŠ¨æ€ä¾èµ–ä¿®å¤æ–¹æ¡ˆ

## ğŸš€ æ¦‚è¿°

æ— éœ€é‡æ–°æ„å»ºDockeré•œåƒï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤ç¼ºå¤±çš„ä¾èµ–ã€‚

## ğŸ”§ ä¿®å¤åŸç†

### é—®é¢˜åˆ†æ
- `@next/mdx` ç­‰ä¾èµ–åœ¨ `devDependencies` ä¸­
- Dockeræ„å»ºæ—¶æ¸…ç†ç”Ÿäº§ä¾èµ–å¯¼è‡´è¿è¡Œæ—¶ç¼ºå¤±
- Next.jsé…ç½®æ–‡ä»¶éœ€è¦è¿™äº›ä¾èµ–

### åŠ¨æ€ä¿®å¤æ–¹æ¡ˆ
1. **æŒ‚è½½ä¿®å¤è„šæœ¬**: `fix-deps.sh` â†’ `/app/fix-deps.sh`
2. **æŒ‚è½½æ›´æ–°çš„é…ç½®**: `package.json` â†’ `/app/package.json`
3. **å¯åŠ¨æ—¶æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹ç¼ºå¤±ä¾èµ–
4. **åŠ¨æ€å®‰è£…**: ä¸´æ—¶å®‰è£…åˆ°å®¹å™¨ä¸­
5. **æ­£å¸¸å¯åŠ¨**: ç»§ç»­å¯åŠ¨Next.jsæœåŠ¡

## ğŸ“ ç›¸å…³æ–‡ä»¶

### 1. `fix-deps.sh` - ä¾èµ–ä¿®å¤è„šæœ¬
```bash
#!/bin/bash
# æ£€æŸ¥å’Œå®‰è£…ç¼ºå¤±çš„MDXä¾èµ–
yarn list @next/mdx || yarn add @next/mdx@^14.2.3 @mdx-js/loader@^3.0.1 @mdx-js/react@^3.0.1 @types/mdx@^2.0.13
exec "$@"  # å¯åŠ¨åº”ç”¨
```

### 2. `docker-compose.yml` - è‡ªåŠ¨ä¿®å¤é…ç½®
```yaml
services:
  app:
    image: markdown-to-image-serve:latest
    volumes:
      - ./fix-deps.sh:/app/fix-deps.sh:ro
      - ./package.json:/app/package.json:ro
    command: ["/app/fix-deps.sh", "yarn", "start"]
```

### 3. `docker-run.sh` - æ›´æ–°çš„å¯åŠ¨è„šæœ¬
- å‰å°å¯åŠ¨: å«ä¾èµ–ä¿®å¤
- åå°å¯åŠ¨: å«ä¾èµ–ä¿®å¤  
- docker-compose: ä½¿ç”¨ä¿®å¤é…ç½®

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1: ä½¿ç”¨ docker-composeï¼ˆæ¨èï¼‰
```bash
# å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨ä¿®å¤ä¾èµ–ï¼‰
docker-compose up -d

# æŸ¥çœ‹ä¿®å¤æ—¥å¿—
docker-compose logs
```

### æ–¹å¼2: ä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
# å¯åŠ¨è„šæœ¬ï¼ˆåŒ…å«ä¿®å¤åŠŸèƒ½ï¼‰
./docker-run.sh

# é€‰æ‹©ä»»æ„å¯åŠ¨æ–¹å¼éƒ½ä¼šè‡ªåŠ¨ä¿®å¤ä¾èµ–
```

### æ–¹å¼3: æ‰‹åŠ¨Dockerå‘½ä»¤
```bash
docker run --rm -it \
  -p 3000:3000 \
  -v "$(pwd)/fix-deps.sh:/app/fix-deps.sh:ro" \
  -v "$(pwd)/package.json:/app/package.json:ro" \
  -e API_PASSWORD=123456 \
  markdown-to-image-serve:latest \
  /app/fix-deps.sh yarn start
```

## ğŸ“‹ å¯åŠ¨è¿‡ç¨‹

### 1. ä¾èµ–æ£€æŸ¥é˜¶æ®µ (10-30ç§’)
```
ğŸ”§ æ£€æŸ¥å’Œä¿®å¤ä¾èµ–...
ğŸ“¦ å‘ç° @next/mdx ç¼ºå¤±ï¼Œæ­£åœ¨å®‰è£…...
âœ… ä¾èµ–å®‰è£…å®Œæˆ
ğŸš€ å¯åŠ¨ Next.js æœåŠ¡...
```

### 2. æ­£å¸¸å¯åŠ¨
```
â–² Next.js 14.2.3
- Local:        http://localhost:3000
- Ready in 1234ms
```

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

| æ–¹æ¡ˆ | é‡æ–°æ„å»ºé•œåƒ | åŠ¨æ€ä¿®å¤ |
|------|-------------|----------|
| **æ—¶é—´æˆæœ¬** | 10-15åˆ†é’Ÿ | 10-30ç§’ |
| **ç½‘ç»œéœ€æ±‚** | å¤§é‡ä¸‹è½½ | ä»…ä¸‹è½½ç¼ºå¤±ä¾èµ– |
| **å­˜å‚¨ç©ºé—´** | æ–°é•œåƒ3.5GB+ | æ— é¢å¤–ç©ºé—´ |
| **çµæ´»æ€§** | å›ºå®šä¾èµ– | å¯éšæ—¶è°ƒæ•´ |
| **å›æ»šéš¾åº¦** | å›°éš¾ | ç®€å• |

## âš¡ æ€§èƒ½å½±å“

### é¦–æ¬¡å¯åŠ¨
- ä¾èµ–æ£€æŸ¥: 5-10ç§’
- ä¾èµ–å®‰è£…: 10-20ç§’  
- æœåŠ¡å¯åŠ¨: 5-10ç§’
- **æ€»è®¡**: 20-40ç§’

### åç»­å¯åŠ¨
- ä¾èµ–æ£€æŸ¥: 2-5ç§’ï¼ˆå·²å­˜åœ¨ï¼‰
- æœåŠ¡å¯åŠ¨: 5-10ç§’
- **æ€»è®¡**: 7-15ç§’

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: ä¾èµ–å®‰è£…å¤±è´¥
```bash
# æŸ¥çœ‹å®‰è£…æ—¥å¿—
docker-compose logs app

# æ‰‹åŠ¨è¿›å…¥å®¹å™¨æ£€æŸ¥
docker exec -it <container_id> /bin/bash
yarn list @next/mdx
```

### é—®é¢˜2: è„šæœ¬æƒé™é—®é¢˜
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x fix-deps.sh
```

### é—®é¢˜3: æŒ‚è½½è·¯å¾„é”™è¯¯
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la fix-deps.sh package.json

# æ£€æŸ¥å®¹å™¨å†…æŒ‚è½½
docker exec -it <container_id> ls -la /app/fix-deps.sh
```

## ğŸ‰ æµ‹è¯•éªŒè¯

### å¿«é€Ÿæµ‹è¯•
```bash
# æµ‹è¯•ä¿®å¤è„šæœ¬
./fix-deps.sh echo "æµ‹è¯•æˆåŠŸ"

# å¯åŠ¨æœåŠ¡æµ‹è¯•
docker-compose up -d
sleep 30
curl http://localhost:3000
```

### å®Œæ•´æµ‹è¯•
```bash
# 1. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# 3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker-compose logs app

# 4. æµ‹è¯•API
curl -X POST http://localhost:3000/api/generatePosterImage \
  -H "Content-Type: application/json" \
  -d '{"markdown":"# æµ‹è¯•","password":"123456"}'
```

## ğŸ“Š æ€»ç»“

âœ… **æ— éœ€é‡æ–°æ„å»ºé•œåƒ**  
âœ… **å¯åŠ¨æ—¶é—´ä»15åˆ†é’Ÿç¼©çŸ­åˆ°30ç§’**  
âœ… **ä¿æŒç°æœ‰é•œåƒä¸å˜**  
âœ… **æ”¯æŒåŠ¨æ€ä¾èµ–è°ƒæ•´**  
âœ… **å®Œå…¨è‡ªåŠ¨åŒ–ä¿®å¤**  

è¿™ç§æ–¹æ¡ˆæ—¢èŠ‚çœäº†æ—¶é—´ï¼Œåˆä¿æŒäº†çµæ´»æ€§ï¼ğŸš€
