# ğŸš€ Dockerå®¹å™¨ä¿®å¤æŒ‡å—ï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘é•œåƒï¼‰

## ğŸ“‹ å¯ç”¨çš„ä¿®å¤æ–¹æ¡ˆ

æˆ‘ä¸ºä½ å‡†å¤‡äº†3ç§ä¸åŒçš„æ–¹æ¡ˆæ¥åº”ç”¨ä¿®å¤ï¼Œé€‰æ‹©æœ€é€‚åˆä½ çš„æƒ…å†µï¼š

---

## ğŸ¯ **æ–¹æ¡ˆ1: é‡å¯å®¹å™¨åº”ç”¨ä¿®å¤ï¼ˆæ¨èï¼‰**

**æ–‡ä»¶**: `apply-fixes-to-docker.sh`

**é€‚ç”¨åœºæ™¯**: 
- âœ… å¯ä»¥æ¥å—çŸ­æš‚æœåŠ¡ä¸­æ–­ï¼ˆçº¦30ç§’ï¼‰
- âœ… éœ€è¦ç¡®ä¿ä¿®å¤å®Œå…¨ç”Ÿæ•ˆ
- âœ… ç¬¬ä¸€æ¬¡åº”ç”¨ä¿®å¤

**ä¼˜åŠ¿**: 
- ğŸ”’ æœ€ç¨³å®šå¯é 
- ğŸ§ª åŒ…å«è‡ªåŠ¨æµ‹è¯•éªŒè¯
- ğŸ“Š æä¾›è¯¦ç»†çŠ¶æ€æŠ¥å‘Š

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /path/to/markdown-to-image-serve
./apply-fixes-to-docker.sh
```

---

## ğŸ”¥ **æ–¹æ¡ˆ2: çƒ­ä¿®å¤è¿è¡Œä¸­å®¹å™¨ï¼ˆé›¶åœæœºï¼‰**

**æ–‡ä»¶**: `hotfix-running-container.sh`

**é€‚ç”¨åœºæ™¯**:
- âœ… ä¸èƒ½åœæ­¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡
- âœ… éœ€è¦é›¶åœæœºæ—¶é—´
- âœ… å¿«é€Ÿåº”ç”¨ç´§æ€¥ä¿®å¤

**ä¼˜åŠ¿**:
- âš¡ é›¶åœæœºæ—¶é—´
- ğŸ”„ æ”¯æŒçƒ­é‡è½½
- ğŸ’¾ è‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /path/to/markdown-to-image-serve  
./hotfix-running-container.sh
```

---

## ğŸ“¦ **æ–¹æ¡ˆ3: Docker Composeç®¡ç†ï¼ˆé•¿æœŸè¿è¡Œï¼‰**

**æ–‡ä»¶**: `docker-compose-with-fixes.yml`

**é€‚ç”¨åœºæ™¯**:
- âœ… éœ€è¦é•¿æœŸç¨³å®šè¿è¡Œ
- âœ… å¸Œæœ›é…ç½®åŒ–ç®¡ç†
- âœ… å›¢é˜Ÿç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒ

**ä¼˜åŠ¿**:
- ğŸ› ï¸ é…ç½®åŒ–ç®¡ç†
- ğŸ”„ å®¹æ˜“é‡å¯å’Œæ›´æ–°
- ğŸ“‚ å®Œæ•´çš„æ–‡ä»¶æŒ‚è½½

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /path/to/markdown-to-image-serve
docker-compose -f docker-compose-with-fixes.yml up -d
```

---

## ğŸ”§ **ä¿®å¤å†…å®¹è¯´æ˜**

æ‰€æœ‰æ–¹æ¡ˆéƒ½åŒ…å«ä»¥ä¸‹å…³é”®ä¿®å¤ï¼š

### âœ… **PosterView.tsxå†…å®¹å°ºå¯¸ä¿®å¤**
```typescript
// æ ¹æ®å®½åº¦åŠ¨æ€è®¾ç½®å°ºå¯¸
const posterSize = posterWidth >= 1000 ? 'desktop' : posterWidth >= 700 ? 'tablet' : 'mobile';
<Md2Poster theme={theme as IThemeType} size={posterSize as any}>
```

### âœ… **Chromeè·¯å¾„ä¿®å¤**
```bash
CHROME_PATH=/usr/bin/chromium  # ä» /usr/bin/google-chrome-unstable ä¿®å¤
```

### âœ… **ç¯å¢ƒå˜é‡ä¼˜åŒ–**
```bash
NODE_ENV=production
API_PASSWORD=123456
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

---

## ğŸš€ **å¿«é€Ÿå¼€å§‹æ¨èæµç¨‹**

### å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡åº”ç”¨ä¿®å¤ï¼š
```bash
cd /Users/xiangping.liao/Documents/wp/crocodile/markdowntoimage/markdown-to-image-serve
./apply-fixes-to-docker.sh
```

### å¦‚æœå®¹å™¨å·²åœ¨è¿è¡Œä¸”ä¸èƒ½åœæ­¢ï¼š
```bash
./hotfix-running-container.sh
```

### å¦‚æœéœ€è¦é•¿æœŸç¨³å®šè¿è¡Œï¼š
```bash
docker-compose -f docker-compose-with-fixes.yml up -d
```

---

## ğŸ§ª **éªŒè¯ä¿®å¤æ•ˆæœ**

ä¿®å¤åº”ç”¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

### 1. è®¿é—®æœåŠ¡
```bash
curl http://localhost:3000
```

### 2. æµ‹è¯•API
```bash
curl -X POST http://localhost:3000/api/generatePosterImage \
  -H "Content-Type: application/json" \
  -d '{
    "markdown": "# ğŸ–¥ï¸ æ¡Œé¢ç‰ˆæµ‹è¯•\n\nå­—ä½“åº”è¯¥è¾ƒå¤§",
    "width": 1200, "height": 800, "password": "123456"
  }'
```

### 3. å¯¹æ¯”æµ‹è¯•
ç”Ÿæˆ400px(æ‰‹æœºç‰ˆ)å’Œ1200px(æ¡Œé¢ç‰ˆ)çš„å›¾ç‰‡ï¼Œå¯¹æ¯”å­—ä½“å¤§å°å·®å¼‚

---

## ğŸ“Š **é¢„æœŸæ•ˆæœ**

ä¿®å¤æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

| è®¾å¤‡ç±»å‹ | å›¾ç‰‡å®½åº¦ | PosterViewå°ºå¯¸ | å­—ä½“æ•ˆæœ |
|---------|----------|--------------|----------|
| ğŸ–¥ï¸ æ¡Œé¢ç‰ˆ | â‰¥1000px | `desktop` | å­—ä½“æœ€å¤§ |
| ğŸ“Š å¹³æ¿ç‰ˆ | 700-999px | `tablet` | å­—ä½“ä¸­ç­‰ |
| ğŸ“± æ‰‹æœºç‰ˆ | <700px | `mobile` | å­—ä½“æœ€å° |

---

## ğŸ†˜ **æ•…éšœæ’é™¤**

å¦‚æœä¿®å¤æœªç”Ÿæ•ˆï¼š

1. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**: `docker ps`
2. **æŸ¥çœ‹å®¹å™¨æ—¥å¿—**: `docker logs <container_id>`
3. **é‡å¯å®¹å™¨**: `docker restart <container_id>`
4. **æ¢å¤å¤‡ä»½**: è„šæœ¬ä¼šæä¾›æ¢å¤å‘½ä»¤

---

## ğŸ’¡ **é€‰æ‹©å»ºè®®**

- **ğŸƒâ€â™‚ï¸ å¿«é€Ÿä¿®å¤**: é€‰æ‹©æ–¹æ¡ˆ1 (`apply-fixes-to-docker.sh`)
- **ğŸ”¥ é›¶åœæœº**: é€‰æ‹©æ–¹æ¡ˆ2 (`hotfix-running-container.sh`) 
- **ğŸ¢ ç”Ÿäº§ç¯å¢ƒ**: é€‰æ‹©æ–¹æ¡ˆ3 (Docker Compose)

**æ‰€æœ‰æ–¹æ¡ˆéƒ½æ— éœ€é‡æ–°ç¼–è¯‘é•œåƒï¼Œå‡ åˆ†é’Ÿå†…å³å¯å®Œæˆï¼**
